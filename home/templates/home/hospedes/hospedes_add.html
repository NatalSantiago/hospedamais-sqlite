{% extends "home/base.html" %}

{% load crispy_forms_tags %}

{% block content %}

{% load widget_tweaks %}

{% load static %}

{% csrf_token %}

{% block extrahead %}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>  
{% endblock %}

<div class="card">
    <div class="card-body">
        <h4>ADICIONAR HOSPEDES<h4>
        <hr>
        {{ form.media }}        
        <form action="{% url 'hospedes_add' %}" method='POST' id='form-hospede'>
            {% csrf_token %}
            <div class="form-row">
              <div class="form-group col-md-6 mb-0">
                {{ form.nome|as_crispy_field }}
              </div>
              <div class="form-group col-md-2 mb-0">
                {{ form.cpf|as_crispy_field }}
              </div>
              <div class="form-group col-md-2 mb-0">
                {{ form.datanascimento|as_crispy_field }}
              </div>
              <div class="form-group col-md-2 mb-0">
                {{ form.generohospede|as_crispy_field }}
              </div>
            </div>
            <div class="form-row">
              <div class="form-group col-md-6 mb-0">
                {{ form.email|as_crispy_field }}
              </div>
              <div class="form-group col-md-3 mb-0">
                {{ form.fone|as_crispy_field }}
              </div>
              <div class="form-group col-md-3 mb-0">
                {{ form.profissao|as_crispy_field }}
              </div>
            </div>
            <div class="form-row">
              <div class="form-group col-md-2 mb-0">
                {{ form.nacionalidade|as_crispy_field }}
              </div>
              <div class="form-group col-md-4 mb-0">
                {{ form.endereco|as_crispy_field }}
              </div>
              <div class="form-group col-md-3 mb-0">
                {{ form.cidade|as_crispy_field }}
              </div>
              <div class="form-group col-md-1 mb-0">
                {{ form.estado|as_crispy_field }}
              </div>
              <div class="form-group col-md-2 mb-0">
                {{ form.cep|as_crispy_field }}
              </div>
            </div>
            <div class="form-row">
              <div class="form-group col-md-3 mb-0">
                {{ form.Pais|as_crispy_field }}
              </div>
              <div class="form-group col-md-3 mb-0">
                {{ form.tipodocindentificacao|as_crispy_field }}
              </div>
              <div class="form-group col-md-3 mb-0">
                {{ form.numerodocumento|as_crispy_field }}
              </div>
              <div class="form-group col-md-3 mb-0">
                {{ form.orgaodocumento|as_crispy_field }}
              </div>
            </div>
            <!-- ###########################################################  -->
            <div class="container-fluid">
              <div class="row">
                <div class="card col-md-6 mb-0">
                  <div class="card-header">Movivo viagem</div>
                  <div class="card-body">
                    <div class="form-row">
                      <div class="form-group col-md-4 mb-0">
                         {{ form.motviagemLazerferias|as_crispy_field }}
                       </div>
                       <div class="form-group col-md-4 mb-0">
                         {{ form.motviagemCongressoFeira|as_crispy_field }}
                       </div>
                       <div class="form-group col-md-4 mb-0">
                         {{ form.motviagemEstudoCursos|as_crispy_field }}
                       </div>
                       <div class="form-group col-md-4 mb-0">
                         {{ form.motviagemNegocios|as_crispy_field }}
                       </div>
                       <div class="form-group col-md-4 mb-0">
                         {{ form.motviagemParentesAmigos|as_crispy_field }}
                       </div>
                       <div class="form-group col-md-4 mb-0">
                         {{ form.motviagemReligiao|as_crispy_field }}
                       </div>
                       <div class="form-group col-md-4 mb-0">
                         {{ form.motviagemCompras|as_crispy_field }}
                       </div>
                       <div class="form-group col-md-4 mb-0">
                         {{ form.motviagemOutros|as_crispy_field }}
                       </div>
                     </div>
                    </div>
                </div>
                <!-- ###########################################################  -->
                <div class="card col-md-6 mb-0">
                  <div class="card-header">Meio de transporte</div>
                  <div class="card-body">
                    <div class="form-row">
                      <div class="form-row">
                        <div class="form-group col-md-4 mb-0">
                          {{ form.meiotransporteAviao|as_crispy_field }}
                        </div>
                        <div class="form-group col-md-4 mb-0">
                          {{ form.meiotransporteCarro|as_crispy_field }}
                        </div>
                        <div class="form-group col-md-4 mb-0">
                          {{ form.meiotransporteOnibus|as_crispy_field }}
                        </div>
                        <div class="form-group col-md-4 mb-0">
                          {{ form.meiotransporteMoto|as_crispy_field }}
                        </div>
                        <div class="form-group col-md-4 mb-0">
                          {{ form.meiotransporteNavio|as_crispy_field }}
                        </div>
                        <div class="form-group col-md-4 mb-0">
                          {{ form.meiotransporteTrem|as_crispy_field }}
                        </div>
                        <div class="form-group col-md-4 mb-0">
                          {{ form.meiotransporteOutros|as_crispy_field }}
                        </div>
                      </div>
                     </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- ###########################################################  -->
            <br>
            <button id="btn-save" class="btn btn-primary" type="submit" name="action" value="save_add">Salvar e adicionar outro</button>
            <button class="btn btn-success" type="submit" name="action" value="save_exit">Salvar e sair</button>
            <a href="{% url 'hospedes' %}" class="btn btn-danger">Cancelar</a>
        </form>
    </div>
</div>    

<!-- ###### Ativar o prescionamento da tecla ENTER ##################  -->
<script src="{% static 'js/custom.js' %}"></script>
<script>
  enableFormTabbing();
</script>
<!-- ########################## FIM ################################# -->


<!-- ########### Colocar o foco no campo descricao ##################  -->
<script>
   document.addEventListener('DOMContentLoaded', function() {
   document.getElementById('{{ form.nome.id_for_label }}').focus();
   });
</script>
<!-- ########################## FIM ################################# -->

{% block extrascripts %}
<script>

$(document).ready(function() {
  var nomeField = $('#{{ form.nome.id_for_label }}');

  nomeField.blur(function() {
    var nomeValue = nomeField.val().trim().toUpperCase();

    if (nomeValue === '') {
      return;
    }

    $.ajax({
      url: '{% url "verificaSeHospedeExite" %}',
      method: 'POST',
      data: {
        'nome': nomeValue,
        'csrfmiddlewaretoken': '{{ csrf_token }}',
      },
      success: function(data) {
        if (data.nome_existente) {
          nomeField.val(''); // Limpa o valor do campo nome
          nomeField.focus(); // Volta o foco para o campo nome
          Swal.fire({
            title: nomeValue,
            text: "Este hóspede já esta cadastrado  ! !",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            cancelButtonText: 'Cancelar',
            confirmButtonText: 'Editar este hóspede',

          }).then((result) => {
             if (result.isConfirmed) {
               var hospedeId = data.id;
               var url = "/hospedes/edit/" + hospedeId;
               window.location.href = url;
             }
          })
          $(this).focus();
        }
      },
    });
  });
});
</script>

{% endblock %}


{% endblock %}


